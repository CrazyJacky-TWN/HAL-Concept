/**
 * @file hal_max96853.c
 * @brief MAX96853 HAL driver.
 *
 * @copyright (c) 2023 Qualcomm Technologies, Inc.
 * All Rights Reserved.
 * Confidential and Proprietary - Qualcomm Technologies, Inc.
 */
#include <stdbool.h>
#include "app_serializer.h"



STATIC iic_device_t *gpDevSer = NULL;
STATIC iic_msg_t gMsgSer;

const uint8_t gSerInit[][4U] = 
{
	{0x90,0x00,0x10,0x91},
	{0x80,0x00,0x10,0x80},
	{'D',0x0A},
	{0x90,0x04,0x49,0x75},
	{0x90,0x05,0x49,0x75},
	{0x90,0x00,0x01,0x12},
	{0x90,0x00,0x02,0x43},
	{0x90,0x00,0x05,0x70},
	{0x90,0x01,0xEA,0x05},
	{0x90,0x01,0xCE,0x0F},
	{0x90,0x01,0xCF,0x08},
	{0x90,0x00,0x50,0x00},
	{0x90,0x01,0xD0,0x00},
	{0x90,0x01,0xD1,0x11},
	{0x90,0x01,0xD2,0x22},
	{0x90,0x01,0xD3,0x33},
	{0x90,0x01,0xD4,0x44},
	{0x90,0x00,0x02,0x53},
	{0x80,0x64,0x22,0x00},
	{0x80,0x65,0x00,0x00},
	{0x80,0x65,0x01,0xFF},
	{0x80,0x65,0x02,0xFF},
	{0x80,0x65,0x03,0xFF},
	{0x80,0x65,0x04,0xFF},
	{0x80,0x65,0x05,0xFF},
	{0x80,0x65,0x06,0xFF},
	{0x80,0x65,0x07,0x00},
	{0x80,0x65,0x08,0x04},
	{0x80,0x65,0x09,0x21},
	{0x80,0x65,0x0A,0x00},
	{0x80,0x65,0x0B,0x00},
	{0x80,0x65,0x0C,0x00},
	{0x80,0x65,0x0D,0x00},
	{0x80,0x65,0x0E,0x00},
	{0x80,0x65,0x0F,0x00},
	{0x80,0x65,0x10,0x01},
	{0x80,0x65,0x11,0x00},
	{0x80,0x65,0x12,0x01},
	{0x80,0x65,0x13,0x03},
	{0x80,0x65,0x14,0x00},
	{0x80,0x65,0x15,0x00},
	{0x80,0x65,0x16,0x00},
	{0x80,0x65,0x17,0x00},
	{0x80,0x65,0x18,0x00},
	{0x80,0x65,0x19,0x00},
	{0x80,0x65,0x1A,0x00},
	{0x80,0x65,0x1B,0x00},
	{0x80,0x65,0x1C,0x00},
	{0x80,0x65,0x1D,0x00},
	{0x80,0x65,0x1E,0x00},
	{0x80,0x65,0x1F,0x00},
	{0x80,0x65,0x20,0x00},
	{0x80,0x65,0x21,0x00},
	{0x80,0x65,0x22,0x00},
	{0x80,0x65,0x23,0x00},
	{0x80,0x65,0x24,0x00},
	{0x80,0x65,0x25,0x00},
	{0x80,0x65,0x26,0x01},
	{0x80,0x65,0x27,0x00},
	{0x80,0x65,0x28,0x01},
	{0x80,0x65,0x29,0x00},
	{0x80,0x65,0x2A,0x01},
	{0x80,0x65,0x2B,0x00},
	{0x80,0x65,0x2C,0x01},
	{0x80,0x65,0x2D,0x00},
	{0x80,0x65,0x2E,0x01},
	{0x80,0x65,0x2F,0x00},
	{0x80,0x65,0x30,0x01},
	{0x80,0x65,0x31,0x00},
	{0x80,0x65,0x32,0x01},
	{0x80,0x65,0x33,0x00},
	{0x80,0x65,0x34,0x01},
	{0x80,0x65,0x35,0x00},
	{0x80,0x65,0x36,0x80},
	{0x80,0x65,0x37,0x25},
	{0x80,0x65,0x38,0x80},
	{0x80,0x65,0x39,0x80},
	{0x80,0x65,0x3A,0x70},
	{0x80,0x65,0x3B,0xD0},
	{0x80,0x65,0x3C,0x3D},
	{0x80,0x65,0x3D,0x20},
	{0x80,0x65,0x3E,0x4E},
	{0x80,0x65,0x3F,0x26},
	{0x80,0x65,0x40,0x55},
	{0x80,0x65,0x41,0x00},
	{0x80,0x65,0x42,0x00},
	{0x80,0x65,0x43,0x00},
	{0x80,0x65,0x44,0x00},
	{0x80,0x65,0x45,0x00},
	{0x80,0x65,0x46,0x00},
	{0x80,0x65,0x47,0x00},
	{0x80,0x65,0x48,0x00},
	{0x80,0x65,0x49,0x00},
	{0x80,0x65,0x4A,0x00},
	{0x80,0x65,0x4B,0x10},
	{0x80,0x65,0x4C,0x00},
	{0x80,0x65,0x4D,0x00},
	{0x80,0x65,0x4E,0x00},
	{0x80,0x65,0x4F,0x00},
	{0x80,0x65,0x50,0x00},
	{0x80,0x65,0x51,0x00},
	{0x80,0x65,0x52,0x00},
	{0x80,0x65,0x53,0x00},
	{0x80,0x65,0x54,0x00},
	{0x80,0x65,0x55,0x00},
	{0x80,0x65,0x56,0x00},
	{0x80,0x65,0x57,0x00},
	{0x80,0x65,0x58,0x00},
	{0x80,0x65,0x59,0x00},
	{0x80,0x65,0x5A,0x00},
	{0x80,0x65,0x5B,0x00},
	{0x80,0x65,0x5C,0x00},
	{0x80,0x65,0x5D,0x10},
	{0x80,0x65,0x5E,0x00},
	{0x80,0x65,0x5F,0x00},
	{0x80,0x65,0x60,0x00},
	{0x80,0x65,0x61,0x00},
	{0x80,0x65,0x62,0x00},
	{0x80,0x65,0x63,0x00},
	{0x80,0x65,0x64,0x00},
	{0x80,0x65,0x65,0x00},
	{0x80,0x65,0x66,0x00},
	{0x80,0x65,0x67,0x00},
	{0x80,0x65,0x68,0x00},
	{0x80,0x65,0x69,0x00},
	{0x80,0x65,0x6A,0x00},
	{0x80,0x65,0x6B,0x00},
	{0x80,0x65,0x6C,0x00},
	{0x80,0x65,0x6D,0x00},
	{0x80,0x65,0x6E,0x00},
	{0x80,0x65,0x6F,0x10},
	{0x80,0x65,0x70,0x00},
	{0x80,0x65,0x71,0x00},
	{0x80,0x65,0x72,0x00},
	{0x80,0x65,0x73,0x00},
	{0x80,0x65,0x74,0x00},
	{0x80,0x65,0x75,0x00},
	{0x80,0x65,0x76,0x00},
	{0x80,0x65,0x77,0x00},
	{0x80,0x65,0x78,0x00},
	{0x80,0x65,0x79,0x00},
	{0x80,0x65,0x7A,0x00},
	{0x80,0x65,0x7B,0x00},
	{0x80,0x65,0x7C,0x00},
	{0x80,0x65,0x7D,0x00},
	{0x80,0x65,0x7E,0x00},
	{0x80,0x65,0x7F,0x99},
	{0x80,0x65,0x80,0x00},
	{0x80,0x65,0x81,0x00},
	{0x80,0x65,0x82,0x00},
	{0x80,0x65,0x83,0x00},
	{0x80,0x65,0x84,0x00},
	{0x80,0x65,0x85,0x00},
	{0x80,0x65,0x86,0x00},
	{0x80,0x65,0x87,0x00},
	{0x80,0x65,0x88,0x00},
	{0x80,0x65,0x89,0x00},
	{0x80,0x65,0x8A,0x00},
	{0x80,0x65,0x8B,0x00},
	{0x80,0x65,0x8C,0x00},
	{0x80,0x65,0x8D,0x00},
	{0x80,0x65,0x8E,0x00},
	{0x80,0x65,0x8F,0x00},
	{0x80,0x65,0x90,0x00},
	{0x80,0x65,0x91,0x00},
	{0x80,0x65,0x92,0x00},
	{0x80,0x65,0x93,0x00},
	{0x80,0x65,0x94,0x00},
	{0x80,0x65,0x95,0x00},
	{0x80,0x65,0x96,0x00},
	{0x80,0x65,0x97,0x00},
	{0x80,0x65,0x98,0x00},
	{0x80,0x65,0x99,0x00},
	{0x80,0x65,0x9A,0x00},
	{0x80,0x65,0x9B,0x00},
	{0x80,0x65,0x9C,0x00},
	{0x80,0x65,0x9D,0x00},
	{0x80,0x65,0x9E,0x00},
	{0x80,0x65,0x9F,0x00},
	{0x80,0x65,0xA0,0x00},
	{0x80,0x65,0xA1,0x00},
	{0x80,0x65,0xA2,0x00},
	{0x80,0x65,0xA3,0x00},
	{0x80,0x65,0xA4,0x00},
	{0x80,0x65,0xA5,0x00},
	{0x80,0x65,0xA6,0x00},
	{0x80,0x65,0xA7,0x00},
	{0x80,0x65,0xA8,0x00},
	{0x80,0x65,0xA9,0x00},
	{0x80,0x65,0xAA,0x00},
	{0x80,0x65,0xAB,0x00},
	{0x80,0x65,0xAC,0x00},
	{0x80,0x65,0xAD,0x00},
	{0x80,0x65,0xAE,0x00},
	{0x80,0x65,0xAF,0x00},
	{0x80,0x65,0xB0,0x00},
	{0x80,0x65,0xB1,0x00},
	{0x80,0x65,0xB2,0x00},
	{0x80,0x65,0xB3,0x00},
	{0x80,0x65,0xB4,0x00},
	{0x80,0x65,0xB5,0x00},
	{0x80,0x65,0xB6,0x00},
	{0x80,0x65,0xB7,0x00},
	{0x80,0x65,0xB8,0x00},
	{0x80,0x65,0xB9,0x00},
	{0x80,0x65,0xBA,0x00},
	{0x80,0x65,0xBB,0x00},
	{0x80,0x65,0xBC,0x00},
	{0x80,0x65,0xBD,0x00},
	{0x80,0x65,0xBE,0x00},
	{0x80,0x65,0xBF,0x00},
	{0x80,0x65,0xC0,0x00},
	{0x80,0x65,0xC1,0x00},
	{0x80,0x65,0xC2,0x00},
	{0x80,0x65,0xC3,0x00},
	{0x80,0x65,0xC4,0x00},
	{0x80,0x65,0xC5,0x00},
	{0x80,0x65,0xC6,0x00},
	{0x80,0x65,0xC7,0x00},
	{0x80,0x65,0xC8,0x00},
	{0x80,0x65,0xC9,0x00},
	{0x80,0x65,0xCA,0x00},
	{0x80,0x65,0xCB,0x00},
	{0x80,0x65,0xCC,0x00},
	{0x80,0x65,0xCD,0x00},
	{0x80,0x65,0xCE,0x00},
	{0x80,0x65,0xCF,0x00},
	{0x80,0x65,0xD0,0x00},
	{0x80,0x65,0xD1,0x00},
	{0x80,0x65,0xD2,0x00},
	{0x80,0x65,0xD3,0x00},
	{0x80,0x65,0xD4,0x00},
	{0x80,0x65,0xD5,0x00},
	{0x80,0x65,0xD6,0x00},
	{0x80,0x65,0xD7,0x00},
	{0x80,0x65,0xD8,0x00},
	{0x80,0x65,0xD9,0x00},
	{0x80,0x65,0xDA,0x00},
	{0x80,0x65,0xDB,0x00},
	{0x80,0x65,0xDC,0x00},
	{0x80,0x65,0xDD,0x00},
	{0x80,0x65,0xDE,0x00},
	{0x80,0x65,0xDF,0x00},
	{0x80,0x65,0xE0,0x00},
	{0x80,0x65,0xE1,0x00},
	{0x80,0x65,0xE2,0x00},
	{0x80,0x65,0xE3,0x00},
	{0x80,0x65,0xE4,0x00},
	{0x80,0x65,0xE5,0x00},
	{0x80,0x65,0xE6,0x00},
	{0x80,0x65,0xE7,0x00},
	{0x80,0x65,0xE8,0x00},
	{0x80,0x65,0xE9,0x00},
	{0x80,0x65,0xEA,0x00},
	{0x80,0x65,0xEB,0x00},
	{0x80,0x65,0xEC,0x00},
	{0x80,0x65,0xED,0x00},
	{0x80,0x65,0xEE,0x00},
	{0x80,0x65,0xEF,0x00},
	{0x80,0x65,0xF0,0x00},
	{0x80,0x65,0xF1,0x00},
	{0x80,0x65,0xF2,0x00},
	{0x80,0x65,0xF3,0x00},
	{0x80,0x65,0xF4,0x00},
	{0x80,0x65,0xF5,0x00},
	{0x80,0x65,0xF6,0x00},
	{0x80,0x65,0xF7,0x00},
	{0x80,0x65,0xF8,0x00},
	{0x80,0x65,0xF9,0x00},
	{0x80,0x65,0xFA,0x00},
	{0x80,0x65,0xFB,0x00},
	{0x80,0x65,0xFC,0x00},
	{0x80,0x65,0xFD,0x00},
	{0x80,0x65,0xFE,0x00},
	{0x80,0x65,0xFF,0x00},
	{0x80,0x64,0x22,0x03},
	// {0x80,0x00,0x79,0x01},
	// {0x80,0x00,0x89,0x01},
	{0x80,0x64,0x20,0x10},  //Turn off video
	{0x80,0x70,0x19,0x00},  //Disable MST mode
	{0x80,0x7A,0x14,0x00},  //Disable MST_VS0_DTG_ENABLE
	{0x80,0x70,0x00,0x00},  //Disable LINK_ENABLE
	{0x80,0x70,0x54,0x01},  //Reset DPRX core (VIDEO_INPUT_RESET)
	{'D',0x64},             //DELAY
	{0x80,0x70,0x74,0x14},  //Set MAX_LINK_RATE to 5.4Gb/s
	{0x80,0x70,0x70,0x04},  //Set MAX_LINK_COUNT to 4
	{0x80,0x00,0x9A,0x01},  //Disable CC to I2C,,
	{0x80,0x60,0x64,0x03},
	{0x80,0x60,0x65,0x03},
	{0x80,0x60,0x66,0x03},
	{0x80,0x60,0x67,0x03},
	{0x80,0x60,0x68,0x03},
	{0x80,0x60,0x69,0x03},
	{0x80,0x60,0x70,0x03},
	{0x80,0x60,0x71,0x03},
	{0x80,0x70,0xA4,0x08},  //Set reporting of maximum I2C clock rate to 100KHz
	{0x80,0x70,0x84,0x01},  //report that local EDID is present
	{0x80,0x70,0x00,0x01},  //Enable LINK_ENABLE
	{'D',0x64},             //DELAY
	{0x80,0x7A,0x18,0x05},  //Disable MSA reset
	{0x80,0x7A,0x28,0xFF},
	{0x80,0x7A,0x2A,0xFF},
	{0x80,0x7A,0x24,0xFF},
	{0x80,0x7A,0x27,0x0F},
	{0x80,0x7A,0x14,0x01},
	{0x80,0x64,0x20,0x11},
	{'D',0x64},             //DELAY
	{0x80,0x64,0x20,0x10},
	{'D',0x64},             //DELAY
	{0x80,0x64,0x20,0x11},
	// {0x80,0x02,0x08,0x01},
	// {0x80,0x02,0x09,0xA2},
	// {0x80,0x02,0x0A,0x42},
	// {0x80,0x02,0x0B,0x21},
	// {0x90,0x02,0x06,0x04},
	// {0x90,0x02,0x07,0xA2},
	// {0x90,0x02,0x08,0x42},
	// {0x80,0x02,0x10,0x01},
	// {0x80,0x02,0x11,0xA4},
	// {0x80,0x02,0x12,0x44},
	// {0x80,0x02,0x13,0x21},
	// {0x90,0x02,0x0C,0x04},
	// {0x90,0x02,0x0D,0xA4},
	// {0x90,0x02,0x0E,0x44},
	// {0x80,0x02,0xB0,0x01},
	// {0x80,0x02,0xB1,0xA7},
	// {0x80,0x02,0xB2,0x47},
	// {0x80,0x02,0xB3,0x21},
	// {0x90,0x02,0x15,0x04},
	// {0x90,0x02,0x16,0xA7},
	// {0x90,0x02,0x17,0x47},
	// {0x80,0x02,0xA8,0x01},
	// {0x80,0x02,0xA9,0xAA},
	// {0x80,0x02,0xAA,0x4A},
	// {0x80,0x02,0xAB,0x21},
	// {0x90,0x02,0x1E,0x04},
	// {0x90,0x02,0x1F,0xAA},
	// {0x90,0x02,0x20,0x4A},
	{0x80,0x00,0x29,0x00},
	{'E','O','L','\0'},
};


void Serializer_Init(void)
{
	bool bEol = false;
	uint16_t u16Idx = 0U;
	uint8_t *pData = (uint8_t*)gSerInit[u16Idx];
	
	memset(&gMsgSer, 0, sizeof(gMsgSer));
	gpDevSer = HAL_IIC_Device_Find(SERIALIZER);

	gpDevSer->open();

	while( false == bEol )
	{
		if( *pData == 'E' && *(pData + 1U) == 'O' && \
			*(pData + 2U) == 'L' )
		{
			bEol = true;
		}
		else
		{
			if( *pData == 0x90U )
			{
				; /* skip address 0x90h, it's for rx side. */
			}
			else if( *pData == 0x80U )
			{
				gMsgSer.u16Addr = (uint16_t)(*(pData) >> 1);
				gMsgSer.pData = (pData + 1U);
				gMsgSer.u32Length = 3U;

				if( DEV_OK == gpDevSer->write(&gMsgSer) )
				{

				}
				else
				{
					// DBGApp_StringShow("\r\nI2C write Fail:");
				}
			}
			else if(*pData == 'D')
			{
				// App_DelayMillisecond(*(pData + 1U));
			}
			else
			{
				;
			}

		}

		pData = (pData + 4U);
		u16Idx++;
	}
}
